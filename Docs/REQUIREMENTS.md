# スペースハリアー風3Dシューティングゲーム 要件定義書

## 📌 プロジェクト概要

スペースハリアーにインスパイアされた、ブラウザで動作する3Dシューティングゲームを開発する。
ローポリゴン風のビジュアルで、明るく爽快感のあるゲーム体験を提供する。

> **現状**: 本要件は計画段階のドキュメントのみで、実装はまだ開始されていない。

### ターゲット
- デスクトップブラウザ（Chrome, Firefox, Safari, Edge）

### 公開方法
- GitHub Pagesで公開

---

## 🛠 技術スタック

### コア技術
- **3Dライブラリ**: Three.js v0.181.2
- **開発言語**: TypeScript v5.9.3
- **ビルドツール**: Vite v7.2.4
- **デプロイ**: GitHub Pages (gh-pages)

### 技術的考慮事項
- Viteの設定でGitHub Pages用のbaseパス設定
- パフォーマンス最適化（60fps維持）
- シャドウマッピング（PCFSoftShadowMap）

---

## 📅 開発ステータス

開発はまだ着手前です。以下は計画しているフェーズ構成です。

### フェーズ1: MVP（未着手）
**目標**: 基本的なゲームループを完成させる

予定実装:
- 疑似3D視点（Three.jsパースペクティブカメラ）
- プレイヤー移動（上下左右、キーボード・マウス操作）
- 敵の出現（3種類: TypeA直線型、TypeB左右移動型、TypeC追尾型）
- シューティング（マガジン式リロード: 7発/0.7秒リロード）
- 背景スクロール（チェッカーボード地面・星空・天井）
- 障害物（岩・柱、影付き）
- 衝突判定（球体ベース）
- ライフシステム（HP: 5）
- ゲームオーバー画面
- UI枠（ライフ、ステージ番号、スコア）

### フェーズ2: スコア・ステージシステム（未着手）
**目標**: ゲームに深みを持たせる

予定実装:
- スコアシステム実装（localStorage保存）
- 5ステージ実装
- ステージクリア画面
- ステージ毎の背景色・スピード変更
- スコアベースのステージクリア条件
- ゲームスピード倍率システム（ステージ毎に1.0x～2.0x）
- 敵弾丸システム（EnemyTypeBのみ、特定位置で1発発射）
- 天井スクロールシステム（ステージ3、5）

### フェーズ3: ボス実装（未着手）
**目標**: ゲームの面白さを向上

予定実装:
- ステージ1: 岩型ボス（静止、複数方向弾幕）
- ステージ2: 木型ボス（枝葉部分と幹部分。最初は枝葉部分の破壊、次に幹部分の破壊が必要）
- ステージ3: 円盤型ボス（8の字で回転、複数方向弾幕）
- ステージ4: 中ボス：ザク型（ステージ中盤に登場、一定時間画面に留まり、複数方向弾幕）
- ステージ4: 有機体型ボス（伸びちじみする、複数方向弾幕）
- ステージ5: 中ボス：板型（静止、弾を跳ね返す部分が存在。跳ね返った弾はあたり判定あり）
- ステージ5: 蛇型ボス（分節構造、体から破壊が必要、最期に頭部破壊で撃破。頭だけになった際に攻撃方法が変化）

---

## 🎮 機能要件詳細

### 1. プレイヤー仕様

#### 移動
- **移動範囲**: 画面内（X: -12～12, Y: -7～7）
- **移動速度**: 20 units/sec
- **操作方法**:
  - キーボード: WASD or 矢印キー
  - マウス: マウス移動

#### 射撃
- **発射方法**: マガジン式リロード
  - キーボード: スペースキー
  - マウス: クリック
- **マガジン**: 7発
- **リロード時間**: 0.7秒
- **弾速**: 80 units/sec
- **弾の寿命**: 3秒 or Z < -300

#### ライフ
- **初期HP**: 5
- **ダメージ**: 敵・障害物・敵弾に当たるとHP-1
- **ゲームオーバー**: HP=0

---

### 2. 敵仕様

#### 敵の種類

**タイプA: 直線型**
- 動き: 奥から手前へ直線的に移動
- 耐久力: 1発で撃破
- スコア: 100点
- 速度: 20 units/sec × ステージ倍率

**タイプB: サインウェーブ連隊型**
- 動き: 左右にサインウェーブで揺れながら手前へ（5連隊）
- 耐久力: 1発で撃破
- スコア: 100点
- 速度: 20 units/sec × ステージ倍率
- **特殊能力**: Z=-30到達時、プレイヤーに向けて弾を1発発射（ステージ2,5のみ）

**タイプC: ジグザグ追尾型**
- 動き: ジグザグパターン + プレイヤーへの緩やかな追尾
- 耐久力: 2発で撃破
- スコア: 200点
- 速度: 20 units/sec × ステージ倍率
- 追尾: プレイヤー位置の20%を反映

**タイプD: 上下から連隊型**
- 動き: 上空or地面スレスレから4連隊で現れ、だんだんと上空or地面スレスレに + プレイヤーへの緩やかな追尾
- 耐久力: 1発で撃破
- スコア: 100点

**タイプE: 上から斜めで連隊型**
- 動き: 右上or左上から現れ3連隊で現れ、右下or左下へ斜めに移動。地面スレスレで手前に 
- 耐久力: 1発で撃破
- スコア: 100点

**タイプF: 途中でくるくる回る型**
- 動き: 奥から現れ、プレイヤー に一定近づいたのち大きく円を描くように動いたのち、手前に
- 耐久力: 1発で撃破
- スコア: 100点

#### 敵弾仕様（EnemyBullet）
- **サイズ**: 半径1.5（大きめ）
- **速度**: 10 units/sec（プレイヤー弾の約1/8）
- **色**: 赤（発光Material）
- **発射元**: TypeB（Stage 2, 5）、各ステージ固有ボス
- **有効ステージ**: 2, 3, 5（Stage 3はボス専用弾）

#### 出現システム
- **出現方針**: 
  - Stage 1: 頻度はあまり高くなくABCのみ出現。
  - Stage 2: 頻度はあまり高くなくABCDのみ出現。
  - Stage 3: 敵は登場しない
  - Stage 4: 頻度高くABCDEが出現
  - Stage 5: 頻度高くABCDEFが出現
- **出現位置**: ランダム（X: -10～10, Y: -5～5, Z: -100）
- **種類選択**: ステージ構成にあわせて妥当な配置をする

---

### 3. 障害物仕様

#### 種類
- **岩**: 地面に配置　大き目
- **柱**: 地面から生えており、高さは地面半分のもの、4分の3のもののいずれか
- **木**: 幹と葉の部分で造形。
- **草**: 地面に配置
- **板**: 天井と地面までの高さ。幅は画面の8分の1


#### 配置
- **出現方針**: 
  - Stage 1: 頻度低く、草と木のみ
  - Stage 2: 頻度低く、岩と柱のみ
  - Stage 3: 高頻度。柱と板のみ
  - Stage 4: 中頻度。岩、柱、木、草
  - Stage 5: 高頻度。全ての障害物
- **出現位置**: ランダム（X: -10～10, Y: -3～3, Z: -100）
- **移動速度**: 地面の速度と同一

#### 当たり判定
- プレイヤーが接触するとHP-1
- プレイヤー弾が接触すると弾が消滅
- 当たり判定半径: 2.0

---

### 4. 背景・環境

#### 3D空間
- **カメラ**: PerspectiveCamera (FOV: 75, position: 0, 0, 20)
- **ライト**: 
  - DirectionalLight (白, 位置: 5, 10, 7.5)
  - AmbientLight (白, 強度: 0.3)
- **影**: PCFSoftShadowMap

#### 地面
- **パターン**: チェッカーボード（PlaneGeometry 100×500）
- **テクスチャ**: CanvasTexture（32pxタイル）
- **スクロール**: 0.5 units/sec × ステージ倍率（手前方向）
- **位置**: Y=-5, Z=-250, 回転: -90°
- **色**: ステージ毎に変化

#### 天井
- **有効ステージ**: Stage 3, 5
- **構造**: 地面と同じPlaneGeometry
- **位置**: Y=15, Z=-250, 回転: 90°
- **スクロール**: 地面と同方向（逆offset）
- **色**: ステージ毎に変化

#### 星空
- **粒子数**: 1000個
- **範囲**: X: ±100, Y: 10～50, Z: ±250
- **表示**: 天井がない時のみ

---

### 5. ステージシステム

#### ステージ構成

各ステージは、指定秒数経過後にボス（必要に応じて中ボス）を出現させ、撃破でクリアとする。ボス出現タイミング: Stage 1 = 60秒, Stage 2 = 90秒, Stage 3 = 90秒, Stage 4 = 120秒（60秒時に中ボス出現）, Stage 5 = 120秒（60秒時に中ボス出現）。

**Stage 1: Tutorial（緑の地面）**
- クリア条件: ステージ開始から60秒経過後のボス出現→撃破
- ゲームスピード: 1.0x（通常）
- 天井: なし
- 敵弾: なし
- 背景色: 0x87CEEB（青空）

**Stage 2: Speed Up（オレンジの地面）**
- クリア条件: ステージ開始から90秒経過後のボス出現→撃破
- ゲームスピード: 1.5x（やや速い）
- 天井: なし
- 敵弾: あり（EnemyTypeB）
- 背景色: 0xFF6347（トマト色）

**Stage 3: High Speed & Ceiling（マゼンタの地面、青の天井）**
- クリア条件: ステージ開始から90秒経過後のボス出現→撃破
- ゲームスピード: 4.0x（最速）
- 天井: あり
- 道中敵: なし（ボスのみ）
- 敵弾: あり（ボス）
- 背景色: 0x9370DB（紫）

**Stage 4: Mid-Boss（赤の地面）**
- クリア条件: ステージ開始から120秒経過後のボス出現→撃破
- ゲームスピード: 1.0x（通常）
- 天井: なし
- 敵弾: なし
- 中ボス出現: 60秒経過で出現
- 背景色: 0xFF1493（ピンク）

**Stage 5: Final（青の地面、黄色の天井）**
- クリア条件: ステージ開始から120秒経過後のボス出現→撃破
- ゲームスピード: 2.5x（速い）
- 天井: あり
- 敵弾: あり
- 中ボス出現: 60秒経過で出現
- 背景色: 0x000080（濃紺）

---

### 6. UI/HUD

#### ゲーム中の表示
- **残りライフ（HP）**: 左上に数値表示
- **ステージ番号**: 右上に"STAGE X"表示
- **スコア**: 右上にスコア表示
#### ゲームオーバー画面
- "GAME OVER" 表示
- 最終スコア、到達ステージ表示
- "Click to Restart" ボタン

#### ステージクリア画面
- "STAGE X CLEAR!" 表示
- 現在のスコア、ステージボーナス表示
- "Click to Continue" ボタン

---

### 7. スコアシステム

#### 得点方式
- **敵撃破**: 
  - TypeA: 100点
  - TypeB: 200点
  - TypeC: 300点
- **ステージクリア**: ステージ番号 × 1000点

#### ハイスコア
- localStorage保存
- キー: "3d-stg-high-score"

---

## 🎨 ビジュアル仕様

### グラフィックスタイル
- **方向性**: ローポリゴン風
- **シェーディング**: フラットシェーディング（flatShading: true）
- **影**: 全オブジェクトに投影

### カラーパレット
- ステージ毎に異なる背景色
- 敵: 赤(TypeA)、オレンジ(TypeB)、マゼンタ(TypeC)
- 障害物: グレー
- プレイヤー弾: 黄色
- 敵弾: 赤（発光）

---

## ⚙️ 技術仕様

### ディレクトリ構成

```
3d-stg/
├── src/
│   ├── main.ts
│   ├── game/
│   │   ├── Game.ts              # メインゲームループ
│   │   ├── Player.ts            # プレイヤー（マガジン式）
│   │   ├── Enemy.ts             # 敵基底クラス
│   │   ├── EnemyTypeA.ts        # 直線型
│   │   ├── EnemyTypeB.ts        # サインウェーブ型（弾発射）
│   │   ├── EnemyTypeC.ts        # ジグザグ追尾型
│   │   ├── EnemyTypeD.ts        # 上下から連隊型
│   │   ├── EnemyTypeE.ts        # 斜め連隊型
│   │   ├── EnemyTypeF.ts        # 円軌道（途中でくるくる）型
│   │   ├── BOSSType1.ts         # ステージ1 岩型ボス
│   │   ├── BOSSType2.ts         # ステージ2 木型ボス
│   │   ├── BOSSType3.ts         # ステージ3 円盤型ボス
│   │   ├── BOSSType4h.ts        # ステージ4 中ボス（ザク型）
│   │   ├── BOSSType4.ts         # ステージ4 有機体ボス
│   │   ├── BOSSType5h.ts        # ステージ5 中ボス（板型）
│   │   ├── BOSSType5.ts         # ステージ5 蛇型ボス
│   │   ├── Bullet.ts            # プレイヤー弾
│   │   ├── EnemyBullet.ts       # 敵弾
│   │   ├── Obstacle.ts          # 障害物
│   │   └── StageData.ts         # ステージ設定
│   ├── scene/
│   │   ├── SceneManager.ts      # シーン管理
│   │   └── Background.ts        # 背景（地面・天井・星）
│   ├── ui/
│   │   ├── HUD.ts               # ゲーム中UI
│   │   ├── GameOverScreen.ts    # ゲームオーバー
│   │   └── StageClearScreen.ts  # ステージクリア
│   ├── input/
│   │   └── InputManager.ts      # 入力管理
│   ├── utils/
│   │   ├── CollisionDetector.ts # 衝突判定
│   │   └── ScoreManager.ts      # スコア管理
│   └── types/
│       └── index.ts             # 型定義
├── public/
├── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

### パフォーマンス要件
- **フレームレート**: 60fps維持
- **影**: 全オブジェクトに対応
- **スムーズなスクロール**: deltaTime基準

### GitHub Pages設定

**vite.config.ts:**
```typescript
import { defineConfig } from 'vite'

export default defineConfig({
  base: '/3d-stg-codex/',
  build: {
    outDir: 'dist',
  }
})
```

**デプロイ:**
```bash
npm run build
npm run deploy  # gh-pages使用
```

---

## 🎯 ゲームバランス

### 難易度カーブ
- Stage 1: 敵弾なし → 易しい
- Stage 2: 敵弾あり → やや難
- Stage 3: 道中敵なし、最高速 → 難
- Stage 4: 中ボス → やや難
- Stage 5: 中ボス、全種類の敵と障害物 → 最難

### プレイ時間目安
- 1ステージ: 1-2分
- 全クリア: 5-10分

---

## 📝 今後の実装予定


1. **タイトル画面**
   - スタートボタン
   - ハイスコア表示

2. **サウンド**
   - BGM
   - 効果音

---

**作成日**: 2025-11-30  
**最終更新**: 2025-12-01  
**バージョン**: 0.1（計画状態）
