# スペースハリアー風3Dシューティングゲーム 要件定義書

## 📌 プロジェクト概要

スペースハリアーにインスパイアされた、ブラウザで動作する3Dシューティングゲームを開発する。
ローポリゴン風のビジュアルで、明るく爽快感のあるゲーム体験を提供する。

### ターゲット
- デスクトップブラウザ（Chrome, Firefox, Safari, Edge）

### 公開方法
- GitHub Pagesで公開

---

## 🛠 技術スタック

### コア技術
- **3Dライブラリ**: Three.js v0.181.2
- **開発言語**: TypeScript v5.9.3
- **ビルドツール**: Vite v7.2.4
- **デプロイ**: GitHub Pages (gh-pages)

### 技術的考慮事項
- Viteの設定でGitHub Pages用のbaseパス設定
- パフォーマンス最適化（60fps維持）
- シャドウマッピング（PCFSoftShadowMap）

---

## 📅 開発ステータス

### フェーズ1: MVP（最小実装）✅ 完了
**目標**: 基本的なゲームループを完成させる

実装内容:
- ✅ 疑似3D視点（Three.jsパースペクティブカメラ）
- ✅ プレイヤー移動（上下左右、キーボード・マウス操作）
- ✅ 敵の出現（3種類: TypeA直線型、TypeB左右移動型、TypeC追尾型）
- ✅ シューティング（マガジン式リロード: 7発/0.7秒リロード）
- ✅ 背景スクロール（チェッカーボード地面・星空・天井）
- ✅ 障害物（岩・柱、影付き）
- ✅ 衝突判定（球体ベース）
- ✅ ライフシステム（HP: 5）
- ✅ ゲームオーバー画面
- ✅ UI枠（ライフ、ステージ番号、スコア）

### フェーズ2: スコア・ステージシステム ✅ 完了
**目標**: ゲームに深みを持たせる

実装内容:
- ✅ スコアシステム実装（localStorage保存）
- ✅ 5ステージ実装
- ✅ ステージクリア画面
- ✅ ステージ毎の背景色・スピード変更
- ✅ スコアベースのステージクリア条件
- ✅ ゲームスピード倍率システム（ステージ毎に1.0x～2.0x）
- ✅ 敵弾丸システム（EnemyTypeBのみ、特定位置で1発発射）
- ✅ 天井スクロールシステム（ステージ3、5）

### フェーズ3: ボス実装 🚧 進行中
**目標**: ゲームの面白さを向上

実装予定:
- ⏳ ステージ4: 中ボス（静止、複数方向弾幕）
- ⏳ ステージ5: 蛇型ボス（分節構造、頭部破壊で撃破）

---

## 🎮 機能要件詳細

### 1. プレイヤー仕様

#### 移動
- **移動範囲**: 画面内（X: -12～12, Y: -7～7）
- **移動速度**: 20 units/sec
- **操作方法**:
  - キーボード: WASD or 矢印キー
  - マウス: マウス移動

#### 射撃
- **発射方法**: マガジン式リロード
  - キーボード: スペースキー
  - マウス: クリック
- **マガジン**: 7発
- **リロード時間**: 0.7秒
- **弾速**: 80 units/sec
- **弾の寿命**: 3秒 or Z < -300

#### ライフ
- **初期HP**: 5
- **ダメージ**: 敵・障害物・敵弾に当たるとHP-1
- **ゲームオーバー**: HP=0

---

### 2. 敵仕様

#### 敵の種類（3種類）

**タイプA: 直線型（赤色の四面体）**
- 動き: 奥から手前へ直線的に移動
- 耐久力: 1発で撃破
- スコア: 100点
- 速度: 20 units/sec × ステージ倍率

**タイプB: サインウェーブ型（オレンジ色の八面体）**
- 動き: 左右にサインウェーブで揺れながら手前へ
- 耐久力: 2発で撃破
- スコア: 200点
- 速度: 20 units/sec × ステージ倍率
- **特殊能力**: Z=-30到達時、プレイヤーに向けて弾を1発発射（ステージ2,3,5のみ）

**タイプC: ジグザグ追尾型（マゼンタ色の十二面体）**
- 動き: ジグザグパターン + プレイヤーへの緩やかな追尾
- 耐久力: 3発で撃破
- スコア: 300点
- 速度: 20 units/sec × ステージ倍率
- 追尾: プレイヤー位置の20%を反映

#### 敵弾仕様（EnemyBullet）
- **サイズ**: 半径1.5（大きめ）
- **速度**: 10 units/sec（プレイヤー弾の約1/8）
- **色**: 赤（発光Material）
- **発射条件**: EnemyTypeBがZ=-30に到達時、1回のみ
- **有効ステージ**: 2, 3, 5

#### 出現システム
- **出現間隔**: 
  - Stage 1: 2.5秒
  - Stage 2: 2.0秒
  - Stage 3: 1.8秒
  - Stage 4: 2.5秒
  - Stage 5: 1.2秒
- **出現位置**: ランダム（X: -10～10, Y: -5～5, Z: -100）
- **種類選択**: ランダム（TypeA/B/C）

---

### 3. 障害物仕様

#### 種類
- **岩（Dodecahedron）**: 半径1.5
- **柱（Cylinder）**: 半径0.5、高さ3

#### 配置
- **出現間隔**: 
  - Stage 1: 5.0秒
  - Stage 2: 4.5秒
  - Stage 3: 3.0秒
  - Stage 4: 4.0秒
  - Stage 5: 2.5秒
- **出現位置**: ランダム（X: -10～10, Y: -3～3, Z: -100）
- **移動速度**: 20 units/sec × ステージ倍率

#### 当たり判定
- プレイヤーが接触するとHP-1
- プレイヤー弾が接触すると弾が消滅
- 当たり判定半径: 2.0

---

### 4. 背景・環境

#### 3D空間
- **カメラ**: PerspectiveCamera (FOV: 75, position: 0, 0, 20)
- **ライト**: 
  - DirectionalLight (白, 位置: 5, 10, 7.5)
  - AmbientLight (白, 強度: 0.3)
- **影**: PCFSoftShadowMap

#### 地面
- **パターン**: チェッカーボード（PlaneGeometry 100×500）
- **テクスチャ**: CanvasTexture（32pxタイル）
- **スクロール**: 0.5 units/sec × ステージ倍率（手前方向）
- **位置**: Y=-5, Z=-250, 回転: -90°
- **色**: ステージ毎に変化

#### 天井
- **有効ステージ**: Stage 3, 5
- **構造**: 地面と同じPlaneGeometry
- **位置**: Y=15, Z=-250, 回転: 90°
- **スクロール**: 地面と同方向（逆offset）
- **色**: ステージ毎に変化

#### 星空
- **粒子数**: 1000個
- **範囲**: X: ±100, Y: 10～50, Z: ±250
- **表示**: 天井がない時のみ

---

### 5. ステージシステム

#### ステージ構成

**Stage 1: Tutorial（緑の地面）**
- クリア条件: 1200点
- ゲームスピード: 1.0x（通常）
- 天井: なし
- 敵弾: なし
- 背景色: 0x87CEEB（青空）

**Stage 2: Speed Up（オレンジの地面）**
- クリア条件: 2400点
- ゲームスピード: 1.3x（やや速い）
- 天井: なし
- 敵弾: あり（EnemyTypeB）
- 背景色: 0xFF6347（トマト色）

**Stage 3: High Speed & Ceiling（マゼンタの地面、青の天井）**
- クリア条件: 3600点
- ゲームスピード: 1.6x（速い）
- 天井: あり
- 敵弾: あり
- 背景色: 0x9370DB（紫）

**Stage 4: Mid-Boss（赤の地面）**
- クリア条件: 5000点
- ゲームスピード: 1.0x（通常）
- 天井: なし
- 敵弾: なし
- 背景色: 0xFF1493（ピンク）
- ボス: 中ボス（未実装）

**Stage 5: Final（青の地面、黄色の天井）**
- クリア条件: 8000点
- ゲームスピード: 2.0x（最速）
- 天井: あり
- 敵弾: あり
- 背景色: 0x000080（濃紺）
- ボス: 蛇型ボス（未実装）

---

### 6. UI/HUD

#### ゲーム中の表示
- **残りライフ（HP）**: 左上に数値表示
- **ステージ番号**: 右上に"STAGE X"表示
- **スコア**: 右上にスコア表示

#### ゲームオーバー画面
- "GAME OVER" 表示
- 最終スコア、到達ステージ表示
- "Click to Restart" ボタン

#### ステージクリア画面
- "STAGE X CLEAR!" 表示
- 現在のスコア、ステージボーナス表示
- "Click to Continue" ボタン

---

### 7. スコアシステム

#### 得点方式
- **敵撃破**: 
  - TypeA: 100点
  - TypeB: 200点
  - TypeC: 300点
- **ステージクリア**: ステージ番号 × 1000点

#### ハイスコア
- localStorage保存
- キー: "3d-stg-high-score"

---

## 🎨 ビジュアル仕様

### グラフィックスタイル
- **方向性**: ローポリゴン風
- **シェーディング**: フラットシェーディング（flatShading: true）
- **影**: 全オブジェクトに投影

### カラーパレット
- ステージ毎に異なる背景色
- 敵: 赤(TypeA)、オレンジ(TypeB)、マゼンタ(TypeC)
- 障害物: グレー
- プレイヤー弾: 黄色
- 敵弾: 赤（発光）

---

## ⚙️ 技術仕様

### ディレクトリ構成

```
3d-stg/
├── src/
│   ├── main.ts
│   ├── game/
│   │   ├── Game.ts              # メインゲームループ
│   │   ├── Player.ts            # プレイヤー（マガジン式）
│   │   ├── Enemy.ts             # 敵基底クラス
│   │   ├── EnemyTypeA.ts        # 直線型
│   │   ├── EnemyTypeB.ts        # サインウェーブ型（弾発射）
│   │   ├── EnemyTypeC.ts        # ジグザグ追尾型
│   │   ├── Bullet.ts            # プレイヤー弾
│   │   ├── EnemyBullet.ts       # 敵弾
│   │   ├── Obstacle.ts          # 障害物
│   │   └── StageData.ts         # ステージ設定
│   ├── scene/
│   │   ├── SceneManager.ts      # シーン管理
│   │   └── Background.ts        # 背景（地面・天井・星）
│   ├── ui/
│   │   ├── HUD.ts               # ゲーム中UI
│   │   ├── GameOverScreen.ts    # ゲームオーバー
│   │   └── StageClearScreen.ts  # ステージクリア
│   ├── input/
│   │   └── InputManager.ts      # 入力管理
│   ├── utils/
│   │   ├── CollisionDetector.ts # 衝突判定
│   │   └── ScoreManager.ts      # スコア管理
│   └── types/
│       └── index.ts             # 型定義
├── public/
├── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

### パフォーマンス要件
- **フレームレート**: 60fps維持
- **影**: 全オブジェクトに対応
- **スムーズなスクロール**: deltaTime基準

### GitHub Pages設定

**vite.config.ts:**
```typescript
import { defineConfig } from 'vite'

export default defineConfig({
  base: '/3d-stg/',
  build: {
    outDir: 'dist',
  }
})
```

**デプロイ:**
```bash
npm run build
npm run deploy  # gh-pages使用
```

---

## 🎯 ゲームバランス

### 難易度カーブ
- Stage 1: 通常速度、敵弾なし → 易しい
- Stage 2: 1.3x速度、敵弾あり → やや難
- Stage 3: 1.6x速度、天井、敵弾あり → 難
- Stage 4: 通常速度、中ボス → 中
- Stage 5: 2.0x速度、天井、敵弾、ボス → 最難

### プレイ時間目安
- 1ステージ: 1-2分
- 全クリア: 5-10分

---

## 📝 今後の実装予定

### 未実装機能
1. **中ボス（Stage 4）**
   - 静止型
   - 高HP
   - 複数方向弾幕

2. **蛇型ボス（Stage 5）**
   - 分節構造（複数セグメント）
   - 頭部破壊で撃破
   - 弾発射

3. **タイトル画面**
   - スタートボタン
   - ハイスコア表示

4. **サウンド**
   - BGM
   - 効果音

---

**作成日**: 2025-11-30  
**最終更新**: 2025-12-01  
**バージョン**: 2.0
